---
galaxy_info:
  author: Ona Engineering
  description: Installs and configures RapidPro
  company: Ona Systems Inc
  license: Apache-2.0
  min_ansible_version: 1.2
  platforms:
    - name: Ubuntu
      versions:
        - 18.04
  galaxy_tags:
    - rapidpro

dependencies:
  - role: onaio.django
    vars:
      django_system_user: "{{ rapidpro_system_user }}"
      django_system_group: "{{ rapidpro_system_group }}"
      django_system_user_home: "{{ rapidpro_system_user_home }}"
      django_codebase_path: "{{ rapidpro_codebase_path }}"
      django_versioned_path: "{{ rapidpro_versioned_path }}"
      django_checkout_path: "{{ rapidpro_checkout_path }}"
      django_venv_path: "{{ rapidpro_venv_path }}"
      django_git_url: "{{ rapidpro_git_url }}"
      django_git_version: "{{ rapidpro_version }}"
      django_pip_packages: "{{ rapidpro_pip_packages }}"
      django_service_name: "{{ rapidpro_service_name }}"
      django_recreate_virtual_env: "{{ rapidpro_recreate_virtual_env }}"
      django_pip_paths:
        - "{{ django_checkout_path }}/pip-freeze.txt"
      django_local_settings_path: "{{ django_checkout_path }}/temba/settings.py"
      django_settings_template_path: "{{ rapidpro_django_settings_template_path }}"
      django_init_commands: []
      django_static_path: "{{ django_checkout_path }}/sitestatic/"
      django_media_path: "{{ django_system_user_home }}/media/"
      django_settings_module: "temba.settings"
      django_wsgi_module: "temba.wsgi:application"
      django_celery_app: "temba.temba_celery:app"
      django_celeryd_nodes: "{{ rapidpro_celeryd_nodes }}"
      django_celeryd_opts: "{{ rapidpro_celeryd_opts }}"
      django_manage_services: true
      django_environment_vars: "{{ rapidpro_environment_vars }}"
      django_install_deadsnakes_ppa: "{{ rapidpro_install_deadsnakes_ppa }}"
      django_system_wide_dependencies: "{{ rapidpro_system_wide_dependencies }}"
    environment:
      CPLUS_INCLUDE_PATH: "/usr/include/gdal"
      C_INCLUDE_PATH: "/usr/include/gdal"

  - role: onaio.courier
    vars:
      courier_environment_vars: "{{ rapidpro_courier_environment_vars }}"
      courier_version: "{{ rapidpro_courier_version }}"
    when: rapidpro_install_courier

  - role: onaio.mailroom
    vars:
      mailroom_version: "{{ rapidpro_mailroom_version }}"
      mailroom_postgresql_url: "{{ rapidpro_mailroom_postgresql_url }}"
      mailroom_redis_url: "{{ rapidpro_mailroom_redis_url }}"
      mailroom_address: "{{ rapidpro_mailroom_address }}"
      mailroom_port: "{{ rapidpro_mailroom_port }}"
      mailroom_sentry_dsn: "{{ rapidpro_mailroom_sentry_dsn }}"
      mailroom_aws_access_key_id: "{{ rapidpro_mailroom_aws_access_key_id }}"
      mailroom_aws_secret_access_key: "{{ rapidpro_mailroom_aws_secret_access_key }}"
      mailroom_s3_endpoint: "{{ rapidpro_mailroom_s3_endpoint }}"
      mailroom_s3_region: "{{ rapidpro_mailroom_s3_region }}"
      mailroom_s3_disable_ssl: "{{ rapidpro_mailroom_s3_disable_ssl }}"
      mailroom_s3_force_path_style: "{{ rapidpro_mailroom_s3_force_path_style }}"
      mailroom_s3_media_bucket:
      mailroom_librato_token:
      mailroom_librato_username:
    when: rapidpro_install_mailroom